SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[requirement_cores]'))
EXEC dbo.sp_executesql @statement = N'create view requirement_cores (datum___, off__ref, afg__ref, oplage__, aant__e2, aantlbrd, drg__las, aantal_b, rol____b, kern____, diktekrn, kernen) as   select min(plandv__.datum___) datum___, v4vrs___.off__ref, afgart__.afg__ref, v4vrs___.oplage__, afgart__.aant__e2, afgart__.aantlbrd, afgart__.drg__las,  v4eti___.aantal_b, afgart__.rol____b, afgart__.kern____,  afgart__.diktekrn,  CASE when afgart__.aant__e2>0 then CASE when afgart__.drg__las<>''2'' then round((v4vrs___. oplage__/afgart__.aant__e2)+0.5,0) else  round((v4eti___.aantal_b*(v4vrs___.oplage__/v4eti___.aantal_b/afgart__.aant__e2))+0.5,0) END  END as kernen  from afgart__, v4vrs___, plandv__, artiky__, v4eti___ where afgart__.afg__ref=v4vrs___.afg__ref and plandv__.ord__ref=v4vrs___.off__ref and plandv__.ord__ref=v4eti___.off__ref and v4eti___.kpn__ref=(select min(kpn__ref) from v4eti___ where v4eti___.off__ref=plandv__.ord__ref) and plandv__.aktie___=''21'' and plandv__.aktie___=''21'' and plandv__.toestand<3 and afgart__.kern____>0 group by afgart__.afg__ref, v4vrs___.off__ref, v4vrs___.oplage__, afgart__.aant__e2, afgart__.aantlbrd, afgart__.drg__las, v4eti___.aantal_b, afgart__.rol____b,  afgart__.kern____, afgart__.diktekrn
' 
