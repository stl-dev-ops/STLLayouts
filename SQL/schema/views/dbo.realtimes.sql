SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[realtimes]'))
EXEC dbo.sp_executesql @statement = N'create view realtimes   ( jobid, jobdescription, customername, date, month, year, week, machineid, machinename, actionid, actionname, jobrelated, employeeid, employeename, duration )  as  select   jobid = hispnt__.ord__ref,   jobdescription = (select omschr__ from order___ where ord__ref = hispnt__.ord__ref),   customername = (select kla__rpn from order___ where ord__ref = hispnt__.ord__ref),   date = hispnt__.datum___,   month = datepart(month, hispnt__.datum___),   year = datepart(year, hispnt__.datum___),   week = datepart(week, hispnt__.datum___),   machineid = hispnt__.wp___ref,   machinename = (select wp_naam_ from werkpo__ where wp___ref = hispnt__.wp___ref),   actionid = hispnt__.akt__ref,   actionname = (select akt_oms_ from wpakt___ where akt__ref = hispnt__.akt__ref and wp___ref = hispnt__.wp___ref),   jobrelated = (select ordergeb from wpakt___ where akt__ref = hispnt__.akt__ref and wp___ref = hispnt__.wp___ref),   employeeid = hispnt__.wn___ref,   employeename = (select wn_naam_ from werknm__ where wn___ref = hispnt__.wn___ref),   duration = case (substring(hispnt__.duur____,1,2))     when '' -'' then (substring(hispnt__.duur____,3,1)*60+substring(hispnt__.duur____,5,2))*-1     when ''-0'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-1'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-2'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-3'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-4'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1      when ''-5'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-6'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-7'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-8'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     when ''-9'' then (substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2))*-1     else substring(hispnt__.duur____,2,2)*60+substring(hispnt__.duur____,5,2)     end from hispnt__
' 
